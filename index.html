<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Projectile Motion Simulator</title>
    <meta name="description" content="Interactive projectile motion simulator with gravity presets for different planets." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="app.css" />
    <script src="theme.js"></script>
  </head>
  <body>
    <nav class="topnav">
      <div class="brand">Student Physics Lab</div>
      <div class="links">
        <a href="index.html">Simulator</a>
        <a href="mysims.html">My Simulations</a>
        <a href="class11.html">Class 11 Topics</a>
        <a href="class12.html">Class 12 Topics</a>
        <a href="dashboard.html">Profile</a>
      </div>
      <div class="right">
        <button class="btn" id="themeToggle" type="button">Toggle Theme</button>
        <button class="btn" id="signOut" type="button">Logout</button>
      </div>
    </nav>

    <header class="app-header">
      <h1>Projectile Motion Simulator</h1>
      <p class="sub">Adjust angle, speed, and gravity (try different planets) — then launch!</p>
    </header>

    <main class="app" id="appRoot">
      <section class="panel controls" aria-label="Controls">
        <div class="control-row">
          <label>Account</label>
          <div class="control-input">
            <div id="userEmail">Signed in</div>
            <button id="signOut" class="btn" type="button">Sign out</button>
          </div>
        </div>

        <div class="control-row">
          <label for="angle">Angle (°)</label>
          <div class="control-input">
            <input id="angle" type="range" min="0" max="90" step="1" value="45" />
            <output id="angleOut">45°</output>
          </div>
        </div>

        <div class="control-row">
          <label for="speed">Initial speed (m/s)</label>
          <div class="control-input">
            <input id="speed" type="range" min="5" max="120" step="1" value="40" />
            <output id="speedOut">40 m/s</output>
          </div>
        </div>

        <div class="control-row">
          <label for="mass">Mass (kg)</label>
          <div class="control-input">
            <input id="mass" type="range" min="0.1" max="10" step="0.1" value="1" />
            <output id="massOut">1 kg</output>
          </div>
        </div>

        <div class="control-row">
          <label for="planet">Gravity (m/s²)</label>
          <div class="control-input select-row">
            <select id="planet" aria-label="Planet gravity preset">
              <option value="Mercury">Mercury (3.70)</option>
              <option value="Venus">Venus (8.87)</option>
              <option value="Earth" selected>Earth (9.81)</option>
              <option value="Moon">Moon (1.62)</option>
              <option value="Mars">Mars (3.71)</option>
              <option value="Jupiter">Jupiter (24.79)</option>
              <option value="Saturn">Saturn (10.44)</option>
              <option value="Uranus">Uranus (8.69)</option>
              <option value="Neptune">Neptune (11.15)</option>
              <option value="Pluto">Pluto (0.62)</option>
              <option value="Custom">Custom…</option>
            </select>
            <input id="customG" type="number" step="0.01" min="0" value="9.81" disabled aria-label="Custom gravity value" />
          </div>
        </div>

        <div class="buttons">
          <button id="launch" class="btn primary" type="button">Launch</button>
          <button id="pause" class="btn" type="button" disabled>Pause</button>
          <button id="reset" class="btn ghost" type="button" disabled>Reset</button>
        </div>

        <div class="stats" aria-live="polite">
          <div><span class="label">g:</span> <span id="gOut">9.81</span> m/s²</div>
          <div><span class="label">Time of flight:</span> <span id="tOut">—</span> s</div>
          <div><span class="label">Max height:</span> <span id="hOut">—</span> m</div>
          <div><span class="label">Range:</span> <span id="rOut">—</span> m</div>
        </div>

        <div class="control-row">
          <label for="title">Title</label>
          <div class="control-input">
            <input id="title" type="text" placeholder="e.g., 45° @ 40 m/s on Earth" />
            <output></output>
          </div>
        </div>

        <div class="control-row">
          <label for="save">Save</label>
          <div class="control-input">
            <button id="save" class="btn primary" type="button">Save Simulation</button>
            <span id="saveNote"></span>
          </div>
        </div>
      </section>

      <section class="panel stage" aria-label="Simulation canvas">
        <canvas id="canvas" width="1200" height="700" aria-label="Projectile canvas"></canvas>
      </section>

      <section class="panel chart" aria-label="Kinetic energy chart">
        <div class="hstack" style="justify-content: space-between;">
          <div>Realtime Kinetic Energy (J)</div>
          <div id="keOut" class="text-muted">—</div>
        </div>
        <canvas id="chart" width="1200" height="160"></canvas>
      </section>
    </main>

    <footer class="app-footer">
      <p>Tip: Try Moon or Jupiter to see drastic differences. Drag the window size to see responsive scaling.</p>
    </footer>

    <script src="script.js"></script>
    <script>
      // Theme button
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('themeToggle');
        if (btn && window.Theme) btn.addEventListener('click', () => Theme.toggle());
      });
    </script>
    <script type="module">
      // Firebase Auth gate + Firestore save (replace placeholders below)
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
      import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
      import { getFirestore, collection, addDoc, serverTimestamp, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

      const firebaseConfig = {
    apiKey: "AIzaSyCkB2pAUYowjLq9LxTy59e4NzMALQ6sLmQ",
    authDomain: "esp32-firebase-db-89c3d.firebaseapp.com",
    databaseURL: "https://esp32-firebase-db-89c3d-default-rtdb.firebaseio.com",
    projectId: "esp32-firebase-db-89c3d",
    storageBucket: "esp32-firebase-db-89c3d.firebasestorage.app",
    messagingSenderId: "997910939684",
    appId: "1:997910939684:web:bd0d38d039490bdcd130b1"
    };
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const appRoot = document.getElementById('appRoot');
      const userEmailEl = document.getElementById('userEmail');
      const signOutBtn = document.getElementById('signOut');
      const saveBtn = document.getElementById('save');
      const saveNote = document.getElementById('saveNote');

      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          window.location.replace('login.html');
          return;
        }
        userEmailEl.textContent = user.email || 'Signed in';
        // Ensure profile doc exists (email preserved, class can be set via registration)
        try {
          await setDoc(doc(db, 'users', user.uid), { email: user.email || null }, { merge: true });
        } catch (e) { console.warn('Profile upsert failed', e); }
        // Trigger a resize to ensure canvas metrics are correct after auth gating
        try { window.dispatchEvent(new Event('resize')); } catch {}
      });

      signOutBtn.addEventListener('click', async () => {
        await signOut(auth);
        window.location.replace('login.html');
      });

      // Helpers to compute analytics for saving
      const angleEl = document.getElementById('angle');
      const speedEl = document.getElementById('speed');
      const planetEl = document.getElementById('planet');
      const customGEl = document.getElementById('customG');
      const titleEl = document.getElementById('title');

      const planetG = { Mercury: 3.7, Venus: 8.87, Earth: 9.81, Moon: 1.62, Mars: 3.71, Jupiter: 24.79, Saturn: 10.44, Uranus: 8.69, Neptune: 11.15, Pluto: 0.62 };
      const getG = () => planetEl.value === 'Custom' ? Math.max(0.01, parseFloat(customGEl.value) || 9.81) : (planetG[planetEl.value] ?? 9.81);

      function compute(v0, theta, g) {
        const T = (g > 0) ? (2 * v0 * Math.sin(theta)) / g : 0;
        const H = (g > 0) ? ((v0 * Math.sin(theta)) ** 2) / (2 * g) : 0;
        const R = (g > 0) ? ((v0 ** 2) * Math.sin(2 * theta)) / g : 0;
        return { T, H, R };
      }

      saveBtn.addEventListener('click', async () => {
        saveNote.textContent = '';
        const user = auth.currentUser;
        if (!user) { window.location.replace('login.html'); return; }
        const angleDeg = parseFloat(angleEl.value);
        const speed = parseFloat(speedEl.value);
        const g = getG();
        const { T, H, R } = compute(speed, (angleDeg * Math.PI) / 180, g);
        const title = (titleEl.value || `Sim ${angleDeg}° @ ${speed} m/s, g=${g}`).trim();
        try {
          const docRef = await addDoc(collection(db, 'users', user.uid, 'simulations'), {
            title,
            data: { angle: angleDeg, speed, gravity: g, time: T, height: H, range: R },
            createdAt: serverTimestamp(),
          });
          await setDoc(doc(db, 'users', user.uid), { lastSim: { id: docRef.id, title } }, { merge: true });
          saveNote.textContent = 'Saved!';
          saveNote.style.color = 'var(--success)';
          titleEl.value = '';
        } catch (e) {
          console.error(e);
          saveNote.textContent = 'Save failed. Check console.';
          saveNote.style.color = 'var(--danger)';
        }
      });
    </script>
  </body>
</html>
